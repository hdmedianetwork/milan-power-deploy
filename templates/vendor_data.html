{% extends 'base.html' %}

{% block content %}

			<style>
				@media screen and (max-width: 480px) {
					#editMedia {
						display: flex;
						flex-direction: column;
						align-items: center;
						justify-content: center;
					}

					#editMedia form {
						width: 100%;
						margin-bottom: 10px;
					}

				}
				
			</style>

			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

			<script>
				$(document).ready(function(){
					$("#searchBar").on("keyup", function() {
						var value = $(this).val().toLowerCase();
						console.log("Searching for: " + value);
						$("#dataTable tbody tr").filter(function() {
						$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
						});
					});
				});
			</script>

			<main class="content">
				<div class="container-fluid p-0 " >

					<button class="btn btn-info" style="margin-bottom: 10px;">
						<strong>
							<i class="align-middle me-2" data-feather="arrow-left-circle"></i> <span class="align-middle">Back</span>
						</strong>
					</button>

					<h1 class="h3 mb-3"><strong>Salesman</strong> Dashboard: Vendor Table</h1>

					<div class="row">
						<div class="col">
							<div class="card flex-fill">
								<div class="card-header d-flex justify-content-between" id="editMedia">
									<form>
										<input type="text" class="form-control" name="" id="searchBar" placeholder="Type to Search">
									</form>
									<div>
										<a href="{% url 'addParty' %}" class="btn btn-success">Add</a>
										<a onclick="deleteVendor()" class="btn btn-danger">Delete</a>
									</div>
								</div>

								<div class="table-responsive">
									<table class="table" id="dataTable">
										<thead>
											<tr>
												<th>
													<input type="checkbox" name="selectAll" id="selectAll" onchange="selectAll()">
													Select
												</th>
												<th>S.No.</th>
												<th>Comapny Name</th>
												<th>Proprietor Name</th>
												<th>Company Address</th>
												<th>Phone Number</th>
												<th>Total Requests</th>
											</tr>
										</thead>
										<tbody>
											{% if vendors %}
												{% for vendor in vendors %}
												<tr>
													<td><input type="checkbox" name="selectedVendors" id="{{ vendor.vid }}"></td>
													<td>{{ forloop.counter }}</td>
													<td>{{ vendor.company_name }}</td>
													<td>{{ vendor.proprietor_name }}</td>
													<td>{{ vendor.address }}</td>
													<td>{{ vendor.phone_number }}</td>
													<td>{{ vendor.total_requests }}</td>
												</tr>
												{% endfor %}
											{% else %}
												<tr>
													<td colspan="7">No data in table</td>
												</tr>
											{% endif %}
										</tbody>
									</table>
								</div>
							</div>
							<!-- Pagination -->
							{% include 'pagination.html' %}
							<div class="pagination">
								<a href="/salesman/dashboard/vendors/?page=1">&laquo;</a>
								{% if vendors.has_previous %}
								<a href="/salesman/dashboard/vendors/?page={{ vendors.previous_page_number }}">{{ vendors.previous_page_number }}</a>
								{% endif %}
								<a class="active" href="/salesman/dashboard/vendors/?page={{ vendors.number }}">{{ vendors.number }}</a>
								{% if vendors.has_next %}
								<a href="/salesman/dashboard/vendors/?page={{ vendors.next_page_number }}">{{ vendors.next_page_number }}</a>
								{% endif %}
								<a href="/salesman/dashboard/vendors/?page={{ vendors.paginator.num_pages }}">&raquo;</a>
							</div>
							<!-- Pagination Ends -->
						</div>
						<h6 style="margin-top: 10px;">Showing page {{ vendors.number }} out of {{ vendors.paginator.num_pages }}</h6>
					</div>

				</div>
			</main>

			<script>			

				function selectAll(){
					console.log('Checked');
					var checkbox = document.getElementById('selectAll');
					var allBoxes = document.querySelectorAll('input[name="selectedVendors"]');

					if(checkbox.checked){
						console.log('true');
						console.log(allBoxes);
						allBoxes.forEach(function(box) {
							box.checked = true;
						});
					} else {
						console.log('Error');
						allBoxes.forEach(function(box) {
							box.checked = false;
						});
					}
				}

				function deleteVendor(){
					let selectedVendors =  document.querySelectorAll('input[name="selectedVendors"]:checked');
					let vendorIds = Array.from(selectedVendors).map(element => element.id).join(',');
					console.log(vendorIds)
					
					$.ajax({
						type: 'POST',
						url: '{% url "deleteParty" %}',
						data: {
							vendorIds: vendorIds,
							csrfmiddlewaretoken: '{{ csrf_token }}',
						},
						success: function(data){
							alert('Deleted Selection');
							window.location.href = '{% url "viewVendors" %}';
						},
						error: function(data){
							console.log('Error occured');
						}
					});
				}
			</script>

{% endblock %}