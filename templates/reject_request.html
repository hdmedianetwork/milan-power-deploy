{% extends 'base.html' %}

{% block content %}

            <style>
                @media screen and (max-width: 480px) {
					#formInputs {
						display: flex;
						flex-direction: column;
					}

                    #formInputs * {
                        margin-bottom: 10px;
                    }

				}
            </style>

			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3">Rejecting Request</h1>

					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<h5 class="card-title mb-0">Please fill the following details - </h5>
								</div>
								<div class="card-body">
                                    <form method="post" action="" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="row" id="formInputs">

                                            <div class="col">
                                                <label class="form-label">Request Number</label>
                                                <input class="form-control form-control-lg" type="text" name="request_number" placeholder="Enter Request Number" value="{{ request_object.rid }}" readonly/>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div id="col">
                                                <label class="form-label">Reason for Rejection</label>
                                                <textarea class="form-control" id="" name="rejection_reason" rows="3" {% if request.user.role == "salesman" %}readonly{% endif %}>{% if rejection_reason %}{{rejection_reason}}{% endif %}</textarea>
                                            </div>
                                        </div>
										<br>
                                        {% if request.user.role != "salesman" %}
                                            <div class="text-center mt-3">
                                                <button type="submit" class="btn btn-lg btn-success">Submit</button>
                                            </div>
                                        {% endif %}
									</form>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>

            <script>
                $document.on('submit', 'request_form', function(e){
                    var rejection_reason = $('#rejection_reason').val() 

                    e.preventDefault();

                    $.ajax({
                        type: 'POST',
                        url: '{% url "rejectRequest" request_object.rid %}',
                        data: {
                            rejection_reason: rejection_reason,
							csrfmiddlewaretoken: '{{ csrf_token }}',
                        },
                        success: function(data){
                            console.log(data)
                        },
                        error: function(data){
                            console.log('Error')
                        }
                    })
                })
            </script>

{% endblock %}